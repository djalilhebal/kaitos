/**
 * Back to Top button.
 */
class KBackToTop extends HTMLElement {

  static define(tag = 'k-back-to-top', registry = customElements) {
    registry.define(tag, this);
    return this;
  }

  constructor() {
    super();

    this.attachShadow({ mode: 'open' });

    const $style = document.createElement('style');
    $style.textContent = `
        .k-back-to-top {
          position: fixed;
          bottom: 1rem;
          right: 1rem;
          width: 60px;
          height: 60px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          opacity: 0;
          transition: opacity 0.3s, background-color 0.3s;
        }
  
        .k-back-to-top.visible {
          opacity: 1;
        }
  
        .k-back-to-top svg {
          width: 60px;
          height: 60px;
          fill: currentColor;
        }
      `;

    const $button = document.createElement('a');
    $button.className = 'k-back-to-top';
    $button.innerHTML = `
      <svg viewBox="0 0 731 755" xmlns="http://www.w3.org/2000/svg">
        <path d="M288.33 769.044c-5.872-2.744-8.203-4.748-6.974-5.997 1.137-1.156 209.663-1.71 211.52-.561 1.674 1.034-.533 2.993-6.616 5.873l-5.485 2.597-94.223-.022c-89.9-.02-94.406-.107-98.223-1.89zM246.051 748.4c-2.737-1.917-2.877-5.023-.288-6.408 1.294-.693 33.622-1.036 97.777-1.036 85.127 0 96.092.174 98.066 1.557 1.222.856 2.222 2.18 2.222 2.943 0 .763-1 2.088-2.222 2.944-1.974 1.382-12.911 1.556-97.778 1.556-84.866 0-95.803-.174-97.777-1.556zm238.277-6.544c-35.91-3.746-67.725-18.761-91.784-43.317l-10.784-11.007-5.216-.101c-2.868-.056-56.554-.185-119.302-.288l-114.086-.187-6.76-4.35c-3.719-2.392-6.83-4.754-6.914-5.25-.09-.523 32.106-1.109 76.964-1.4l77.117-.5-5.397-9c-12.943-21.58-24.936-48.337-29.76-66.389-7.588-28.403-4.452-56.421 7.585-67.753 14.03-13.208 33.435-9.646 45.65 8.379 5.197 7.668 7.358 12.004 14.836 29.763 3.474 8.25 6.324 14.407 6.334 13.68.01-.725-1.349-8.15-3.018-16.5-1.67-8.348-4.348-22.38-5.95-31.18-1.604-8.8-4.267-23.2-5.92-32-5.505-29.319-10.965-60.844-13.159-75.978-1.828-12.61-2.086-17.807-1.64-32.995.556-18.937 1.853-27.141 6.41-40.527 3.726-10.945 6.16-15.394 20.248-37 6.993-10.725 13.1-20.175 13.571-21 .471-.825-2.886 2.006-7.46 6.291s-8.46 7.647-8.635 7.472c-.175-.175 1.189-4.356 3.03-9.29 3.938-10.548 6.21-23.31 7.137-40.07l.669-12.097 3.617-1.274c5.584-1.966 13.974-7.328 20.993-13.415 10.013-8.685 10.317-9.952 1.326-5.525-14.338 7.06-37.726 14.169-57.215 17.393-11.497 1.902-30.827 3.732-31.968 3.027-1.732-1.07 6.311-18.696 13.239-29.012 9.389-13.98 21.39-26.829 39.262-42.035l12.02-10.227 1.632-8.646c3.089-16.363 10.348-27.533 26.434-40.678 6.52-5.328 7.335-6.386 7.838-10.18 2.457-18.536 3.9-28.41 5.199-35.573.832-4.587 1.317-8.534 1.08-8.772-1.263-1.263-6.305 16.865-9.335 33.561-1.55 8.542-2.097 9.865-5.697 13.77-2.19 2.377-4.188 4.116-4.44 3.865-.786-.787 1.693-17.399 5.237-35.085 1.873-9.35 4.79-24.425 6.483-33.5 1.693-9.075 3.788-18.437 4.657-20.804 2.21-6.023 7.344-9.263 15.746-9.938 8.99-.721 13.126.295 17.584 4.323 3.158 2.853 4.118 4.661 5.41 10.194 2.73 11.688 15.632 80.685 15.632 83.596 0 1.02-3.1-.868-6.107-3.717-1.654-1.567-2.857-4.057-3.29-6.812-2.193-13.966-9.884-41.894-11.179-40.599-.174.175.994 7.954 2.596 17.288 1.603 9.333 3.217 20.246 3.588 24.251l.674 7.282 9.347 7.995c10.692 9.145 16.068 15.79 20.267 25.052 2.535 5.59 3.506 9.256 5.682 21.457.203 1.139 3.863 4.783 8.146 8.112 16.951 13.176 32.98 29.989 42.785 44.878 6.34 9.625 13.26 23.033 14.127 27.37.722 3.612.99 3.572-13.636 2.048-29.789-3.103-58.306-10.741-76.985-20.619-7.945-4.201-8.33-4.308-6.052-1.672 6.785 7.849 17.361 15.7 27.61 20.496l6.427 3.008.018 7.656c.04 18 3.107 35.85 8.058 46.905 1.54 3.438 2.547 6.25 2.24 6.25-.308 0-4.409-3.712-9.113-8.25l-8.553-8.25 2.859 5c1.573 2.75 7.345 11.75 12.828 20s12.166 19.574 14.852 25.163c11.08 23.063 14.29 49.842 9.774 81.54-3.637 25.53-23.149 131.597-28.84 156.77-1.268 5.616-.728 6.395.934 1.344 1.769-5.379 11.816-27.651 15.705-34.817 10.222-18.831 22.867-27.441 36.211-24.655 15.407 3.218 24.037 15.269 26.048 36.371 1.957 20.542-3.2 45.984-14.105 69.59-4.651 10.066-5.512 10.083 15.584-.305 15.088-7.43 31.85-17.81 47.383-29.344 4.61-3.424 8.61-5.997 8.889-5.718 1.093 1.093-6.61 12.169-12.71 18.276-13.842 13.854-42.398 29.176-68.452 36.726-18.255 5.29-27.212 6.663-47.38 7.264-39.738 1.183-65.236-5.903-82.98-23.06-2.887-2.792-5.25-4.707-5.25-4.257 0 .451 1.676 4.008 3.723 7.905 9.575 18.22 32.042 32.466 61.303 38.87 9.158 2.005 13.114 2.284 31.474 2.218 15.186-.055 23.63-.55 30.5-1.79 37.232-6.717 70.035-19.84 93.815-37.533 8.396-6.246 24.53-21.38 19.685-18.464-1.65.993-5.908 3.51-9.463 5.593-9.87 5.786-37.34 16.844-38.631 15.552-.256-.256 2.81-3.09 6.815-6.298 10.915-8.746 20.77-18.493 33.304-32.94 11.372-13.108 21.744-23.498 53.152-53.248l17.153-16.247.716 7.637c.394 4.2.47 16.912.168 28.247-1.406 52.885-15.494 89.616-46.582 121.448-36.786 37.665-89.471 56.212-143.632 50.562zm-283.75-13.98c-2.269-1.321-2.233-4.172.08-6.265 1.674-1.515 9.796-1.655 96.3-1.655 72.143 0 94.754.284 95.67 1.2.66.66 1.2 2.145 1.2 3.3 0 1.155-.54 2.64-1.2 3.3-1.576 1.577-189.348 1.694-192.05.12zM167.052 706.4c-2.445-1.713-2.883-4.383-1.023-6.244 1.592-1.591 207.899-1.753 210.866-.164 2.162 1.157 2.572 4.927.734 6.764-.917.918-25.55 1.2-104.777 1.2-92.127 0-103.823-.172-105.8-1.556zM52.096 564.755c-1.712-2.101-6.22-13.356-10.935-27.299-25.14-74.344-25.555-157.943-1.162-234.41 24.317-76.228 74.702-146.463 136.33-190.039 42.495-30.046 97.447-53.485 144.38-61.584 10.367-1.788 13.522-1.453 15.161 1.61 1.782 3.329-.292 4.556-10.82 6.403-36.324 6.373-70.807 18.58-106.2 37.596-32.71 17.573-57.057 35.798-81.152 60.749-29.732 30.788-48.172 56.689-67.405 94.675-16.365 32.324-26.711 63.665-33.837 102.5-11.994 65.358-4.877 135.174 20.461 200.742 1.87 4.839 2.165 6.637 1.31 8-1.378 2.199-4.73 2.776-6.13 1.057zm663.742-.783c-.927-1.732-.43-3.904 2.815-12.31 18.395-47.645 26.029-91.783 24.91-144.034-.664-30.997-3.877-53.217-12.244-84.672-13.397-50.366-37.43-97.955-68.934-136.5-40.858-49.99-93.669-88.117-151.693-109.515-23.903-8.816-35.611-12.007-68.863-18.773-4.434-.902-5.317-4.302-1.727-6.655 2.194-1.437 3.386-1.397 14.127.468 45.124 7.836 93.773 27.958 135.959 56.235 24.238 16.247 55.144 44.37 75.543 68.74 12.966 15.49 20.707 26.398 31.89 44.93 36.354 60.252 55.162 127.4 55.197 197.07.02 40.035-6.076 77.238-19.064 116.343-8.455 25.454-10.59 30.043-14.172 30.467-1.84.218-2.952-.315-3.744-1.794z" />
      </svg>
    `;

    // Add elements to shadow DOM
    this.shadowRoot.appendChild($style);
    this.shadowRoot.appendChild($button);

    // Bind methods
    this.toggleVisibility = this.toggleVisibility.bind(this);
    this.scrollToTop = this.scrollToTop.bind(this);

    // Add event listeners
    $button.addEventListener('click', this.scrollToTop);
    window.addEventListener('scroll', this.toggleVisibility);

    // Initial visibility check
    this.toggleVisibility();
  }

  toggleVisibility() {
    const $button = this.shadowRoot.querySelector('.k-back-to-top');
    if (window.scrollY > 200) {
      $button.classList.add('visible');
    } else {
      $button.classList.remove('visible');
    }
  }

  scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }

  // Cleanup when element is removed
  disconnectedCallback() {
    window.removeEventListener('scroll', this.toggleVisibility);
  }
}

KBackToTop.define();
